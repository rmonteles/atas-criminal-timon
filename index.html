<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente de Atas - 1¬™ Vara Criminal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .step {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .question {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option-btn {
            background: #f7f7f7;
            border: 2px solid #e0e0e0;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        
        .option-btn:hover {
            background: #1e3c72;
            color: white;
            border-color: #1e3c72;
            transform: translateX(5px);
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }
        
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #1e3c72;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(30, 60, 114, 0.4);
        }
        
        .navigation-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-nav {
            flex: 1;
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-nav:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-nav.restart {
            background: #dc3545;
        }
        
        .btn-nav.restart:hover {
            background: #c82333;
        }
        
        .output-container {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .output-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        
        .output-text {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            font-size: 14px;
            max-height: 500px;
            overflow-y: auto;
            line-height: 1.8;
        }
        
        .btn-copy {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            margin-right: 10px;
            transition: all 0.3s;
        }
        
        .btn-copy:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .btn-copy.copied {
            background: #17a2b8;
        }
        
        .progress-bar {
            background: #e0e0e0;
            height: 6px;
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            height: 100%;
            transition: width 0.5s;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öñÔ∏è Assistente de Atas de Audi√™ncia Criminal</h1>
            <p>1¬™ Vara Criminal da Comarca de Timon - TJMA</p>
        </div>
        
        <div class="content">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            
            <div class="step active" id="step1">
                <div class="question">Qual tipo de ata voc√™ precisa gerar?</div>
                <div class="options">
                    <button class="option-btn" onclick="selectTipoAta('instrucao_julgamento')">
                        ‚öñÔ∏è Audi√™ncia de Instru√ß√£o e Julgamento
                    </button>
                    <button class="option-btn" onclick="selectTipoAta('anpp')">
                        ü§ù Audi√™ncia de Homologa√ß√£o de ANPP
                    </button>
                    <button class="option-btn" onclick="selectTipoAta('sentenca')">
                        üìã Audi√™ncia com Senten√ßa
                    </button>
                    <button class="option-btn" onclick="selectTipoAta('adiamento')">
                        üîÑ Adiamento de Audi√™ncia
                    </button>
                </div>
            </div>
            
            <div id="dynamicSteps"></div>
            
            <div class="step" id="stepOutput">
                <div class="output-container">
                    <div class="output-title">‚úÖ Ata gerada com sucesso!</div>
                    <div class="alert alert-info">
                        <strong>Instru√ß√µes:</strong> Revise o conte√∫do abaixo e clique em "Copiar" para utilizar no sistema PJe.
                    </div>
                    <div class="output-text" id="outputText"></div>
                    <button class="btn-copy" onclick="copyToClipboard()">üìã Copiar para √Årea de Transfer√™ncia</button>
                    <button class="btn-secondary" onclick="resetForm()">üîÑ Gerar Nova Ata</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const state = {
            tipoAta: null,
            currentStep: 1,
            totalSteps: 0,
            respostas: {}
        };

        const fluxos = {
            instrucao_julgamento: [
                {
                    id: 'dados_processo',
                    pergunta: 'Dados do Processo:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'numero_processo', label: 'N√∫mero do Processo', tipo: 'text', placeholder: '0000000-00.0000.0.00.0000' },
                        { nome: 'capitulacao', label: 'Capitula√ß√£o Legal', tipo: 'text', placeholder: 'Art. 157, ¬ß 2¬∞, I e II, do CP' },
                        { nome: 'data_audiencia', label: 'Data da Audi√™ncia', tipo: 'date' },
                        { nome: 'hora_inicio', label: 'Hor√°rio de In√≠cio', tipo: 'time' }
                    ]
                },
                {
                    id: 'link_audiencia',
                    pergunta: 'Link da Webconfer√™ncia:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'link_meet', label: 'Link Google Meet', tipo: 'text', placeholder: 'meet.google.com/xxx-xxxx-xxx' }
                    ]
                },
                {
                    id: 'partes',
                    pergunta: 'Identifica√ß√£o das Partes:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'promotor', label: 'Nome do Promotor de Justi√ßa', tipo: 'text', placeholder: 'Dr. Nome do Promotor' },
                        { nome: 'nome_reu', label: 'Nome do(s) R√©u(s)', tipo: 'textarea', placeholder: 'Nome completo do r√©u ou r√©us separados por v√≠rgula' },
                        { nome: 'tipo_defesa', label: 'Tipo de Defesa', tipo: 'select', opcoes: ['Defensoria P√∫blica', 'Advogado Constitu√≠do'] }
                    ]
                },
                {
                    id: 'defensor_dados',
                    pergunta: 'Dados do Defensor:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.tipo_defesa === 'Advogado Constitu√≠do',
                    tipo_input: 'campos',
                    campos: [
                        { nome: 'nome_defensor', label: 'Nome do Advogado', tipo: 'text' },
                        { nome: 'oab_defensor', label: 'OAB', tipo: 'text', placeholder: 'OAB XX 00000' }
                    ]
                },
                {
                    id: 'defensor_publico',
                    pergunta: 'Nome do Defensor P√∫blico:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.tipo_defesa === 'Defensoria P√∫blica',
                    tipo_input: 'campos',
                    campos: [
                        { nome: 'nome_defensor_publico', label: 'Nome do Defensor P√∫blico', tipo: 'text', placeholder: 'Dr. Nome do Defensor' }
                    ]
                },
                {
                    id: 'presenca_reu',
                    pergunta: 'Presen√ßa do(s) R√©u(s):',
                    tipo: 'opcao',
                    opcoes: [
                        { valor: 'presente', texto: 'R√©u(s) presente(s)' },
                        { valor: 'ausente', texto: 'R√©u(s) ausente(s)' }
                    ]
                },
                {
                    id: 'estudantes',
                    pergunta: 'H√° estudantes presentes?',
                    tipo: 'opcao',
                    opcoes: [
                        { valor: 'sim', texto: 'Sim' },
                        { valor: 'nao', texto: 'N√£o' }
                    ]
                },
                {
                    id: 'dados_estudantes',
                    pergunta: 'Dados dos Estudantes:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.estudantes === 'sim',
                    tipo_input: 'campos',
                    campos: [
                        { nome: 'estudantes_lista', label: 'Nome, matr√≠cula e institui√ß√£o', tipo: 'textarea', placeholder: 'Nome - Matr√≠cula - Institui√ß√£o (um por linha)' }
                    ]
                },
                {
                    id: 'testemunhas_acusacao',
                    pergunta: 'Testemunhas de Acusa√ß√£o:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'testemunhas_acusacao', label: 'Testemunhas presentes (separadas por v√≠rgula)', tipo: 'textarea', placeholder: 'Nome 1, Nome 2...' },
                        { nome: 'testemunhas_ausentes_acusacao', label: 'Testemunhas ausentes (se houver)', tipo: 'textarea', placeholder: 'Nome 1, Nome 2...' }
                    ]
                },
                {
                    id: 'testemunhas_defesa',
                    pergunta: 'Testemunhas de Defesa:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'testemunhas_defesa', label: 'Testemunhas presentes (separadas por v√≠rgula)', tipo: 'textarea', placeholder: 'Nome 1, Nome 2...' },
                        { nome: 'desistencia_testemunhas', label: 'Houve desist√™ncia de testemunhas? (Opcional)', tipo: 'textarea', placeholder: 'Nome das testemunhas dispensadas' }
                    ]
                },
                {
                    id: 'instrucao',
                    pergunta: 'Status da Instru√ß√£o Processual:',
                    tipo: 'opcao',
                    opcoes: [
                        { valor: 'encerrada', texto: 'Instru√ß√£o Encerrada' },
                        { valor: 'adiada', texto: 'Audi√™ncia Adiada' }
                    ]
                },
                {
                    id: 'alegacoes',
                    pergunta: 'Tipo de Alega√ß√µes Finais:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.instrucao === 'encerrada',
                    tipo_input: 'opcao',
                    opcoes: [
                        { valor: 'orais', texto: 'Alega√ß√µes Finais Orais' },
                        { valor: 'memoriais', texto: 'Alega√ß√µes Finais por Memoriais' }
                    ]
                },
                {
                    id: 'manifestacao_mp',
                    pergunta: 'Manifesta√ß√£o do Minist√©rio P√∫blico:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.alegacoes === 'orais',
                    tipo_input: 'campos',
                    campos: [
                        { nome: 'alegacoes_mp', label: 'Resumo das alega√ß√µes do MP', tipo: 'textarea', placeholder: 'Resumo breve da manifesta√ß√£o do Minist√©rio P√∫blico' }
                    ]
                },
                {
                    id: 'manifestacao_defesa',
                    pergunta: 'Manifesta√ß√£o da Defesa:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.alegacoes === 'orais',
                    tipo_input: 'campos',
                    campos: [
                        { nome: 'alegacoes_defesa', label: 'Resumo das alega√ß√µes da Defesa', tipo: 'textarea', placeholder: 'Resumo breve da manifesta√ß√£o da Defesa' }
                    ]
                },
                {
                    id: 'prazo_memoriais',
                    pergunta: 'Prazos para Memoriais:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.alegacoes === 'memoriais',
                    tipo_input: 'campos',
                    campos: [
                        { nome: 'prazo_mp', label: 'Prazo MP (dias)', tipo: 'number', placeholder: '5' },
                        { nome: 'prazo_defesa', label: 'Prazo Defesa (dias)', tipo: 'number', placeholder: '5' }
                    ]
                },
                {
                    id: 'despacho_final',
                    pergunta: 'H√° decis√£o/despacho adicional?',
                    tipo: 'opcao',
                    opcoes: [
                        { valor: 'nao', texto: 'N√£o' },
                        { valor: 'sim', texto: 'Sim, h√° decis√£o/despacho' }
                    ]
                },
                {
                    id: 'texto_despacho',
                    pergunta: 'Texto do Despacho/Decis√£o:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.despacho_final === 'sim',
                    tipo_input: 'campos',
                    campos: [
                        { nome: 'despacho_texto', label: 'Texto do despacho ou decis√£o', tipo: 'textarea', placeholder: 'Digite o texto completo da decis√£o ou despacho' }
                    ]
                },
                {
                    id: 'hora_encerramento',
                    pergunta: 'Hor√°rio de Encerramento:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'hora_encerramento', label: 'Hora', tipo: 'time' }
                    ]
                }
            ],

            anpp: [
                {
                    id: 'dados_processo',
                    pergunta: 'Dados do Processo:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'numero_processo', label: 'N√∫mero do Processo', tipo: 'text', placeholder: '0000000-00.0000.0.00.0000' },
                        { nome: 'capitulacao', label: 'Capitula√ß√£o Legal', tipo: 'text', placeholder: 'Ex: Art. 12 da Lei n¬∫ 10.826/2003' },
                        { nome: 'data_audiencia', label: 'Data da Audi√™ncia', tipo: 'date' },
                        { nome: 'hora_inicio', label: 'Hor√°rio de In√≠cio', tipo: 'time' }
                    ]
                },
                {
                    id: 'link_audiencia',
                    pergunta: 'Link da Webconfer√™ncia:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'link_meet', label: 'Link Google Meet', tipo: 'text', placeholder: 'meet.google.com/xxx-xxxx-xxx' }
                    ]
                },
                {
                    id: 'partes',
                    pergunta: 'Identifica√ß√£o das Partes:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'nome_investigado', label: 'Nome do Investigado/Denunciado', tipo: 'text' },
                        { nome: 'tipo_defesa', label: 'Tipo de Defesa', tipo: 'select', opcoes: ['Defensoria P√∫blica', 'Advogado Constitu√≠do'] }
                    ]
                },
                {
                    id: 'advogado_dados',
                    pergunta: 'Dados do Advogado:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.tipo_defesa === 'Advogado Constitu√≠do',
                    tipo_input: 'campos',
                    campos: [
                        { nome: 'nome_advogado', label: 'Nome do Advogado', tipo: 'text', placeholder: 'Dr. Nome Completo' },
                        { nome: 'oab_advogado', label: 'OAB', tipo: 'text', placeholder: 'OAB XX 00000' }
                    ]
                },
                {
                    id: 'defensor_publico',
                    pergunta: 'Nome do Defensor P√∫blico:',
                    tipo: 'condicional',
                    condicao: (state) => state.respostas.tipo_defesa === 'Defensoria P√∫blica',
                    tipo_input: 'campos',
                    campos: [
                        { nome: 'nome_defensor_publico', label: 'Nome do Defensor P√∫blico', tipo: 'text' }
                    ]
                },
                {
                    id: 'clausulas_anpp',
                    pergunta: 'Cl√°usulas do Acordo (Obriga√ß√µes de Fazer):',
                    tipo: 'campos',
                    campos: [
                        { nome: 'clausula_1', label: 'Cl√°usula I - Primeira obriga√ß√£o', tipo: 'textarea', placeholder: 'Ex: Adquirir 01 Tablet... para doa√ß√£o ao Centro...' },
                        { nome: 'clausula_2', label: 'Cl√°usula II - Segunda obriga√ß√£o (se houver)', tipo: 'textarea', placeholder: 'Ex: Renunciar ao valor de fian√ßa...' },
                        { nome: 'clausula_3', label: 'Cl√°usula III - Terceira obriga√ß√£o (se houver)', tipo: 'textarea', placeholder: 'Ex: Renunciar aos bens apreendidos...' }
                    ]
                },
                {
                    id: 'prazo_cumprimento',
                    pergunta: 'Prazo para Cumprimento das Obriga√ß√µes:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'prazo_dias', label: 'Prazo em dias', tipo: 'number', placeholder: '30' }
                    ]
                },
                {
                    id: 'confirmacao_investigado',
                    pergunta: 'Confirma√ß√µes do Investigado:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'confessou_crime', label: 'Confessou a pr√°tica do crime?', tipo: 'select', opcoes: ['Sim', 'N√£o'] },
                        { nome: 'acordo_clausulas', label: 'Est√° de acordo com as cl√°usulas?', tipo: 'select', opcoes: ['Sim', 'N√£o'] },
                        { nome: 'ciente_restricao', label: 'Est√° ciente da restri√ß√£o de 5 anos?', tipo: 'select', opcoes: ['Sim', 'N√£o'] }
                    ]
                },
                {
                    id: 'data_limite',
                    pergunta: 'Data Limite para Cumprimento:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'data_limite_cumprimento', label: 'Data limite (ser√° calculada automaticamente se deixar em branco)', tipo: 'date' }
                    ]
                },
                {
                    id: 'hora_encerramento',
                    pergunta: 'Hor√°rio de Encerramento:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'hora_encerramento', label: 'Hora', tipo: 'time' }
                    ]
                },
                {
                    id: 'servidor',
                    pergunta: 'Dados do Servidor que digitou:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'nome_servidor', label: 'Nome do Servidor', tipo: 'text', placeholder: 'Nome completo' },
                        { nome: 'matricula_servidor', label: 'Matr√≠cula', tipo: 'text', placeholder: '0000000' }
                    ]
                }
            ],

            sentenca: [
                {
                    id: 'dados_processo',
                    pergunta: 'Dados do Processo:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'numero_processo', label: 'N√∫mero do Processo', tipo: 'text' },
                        { nome: 'data_audiencia', label: 'Data', tipo: 'date' },
                        { nome: 'hora_inicio', label: 'Hor√°rio', tipo: 'time' }
                    ]
                },
                {
                    id: 'tipo_sentenca',
                    pergunta: 'Tipo de Senten√ßa:',
                    tipo: 'opcao',
                    opcoes: [
                        { valor: 'condenatoria', texto: 'Condenat√≥ria' },
                        { valor: 'absolutoria', texto: 'Absolut√≥ria' },
                        { valor: 'improcedencia', texto: 'Improced√™ncia da Den√∫ncia' }
                    ]
                },
                {
                    id: 'fundamento',
                    pergunta: 'Fundamento Legal:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'fundamento_legal', label: 'Artigo do CPP', tipo: 'text', placeholder: 'Ex: Art. 386, VII do CPP' }
                    ]
                },
                {
                    id: 'dispositivo_sentenca',
                    pergunta: 'Dispositivo da Senten√ßa (resumo):',
                    tipo: 'campos',
                    campos: [
                        { nome: 'dispositivo', label: 'Resumo do dispositivo', tipo: 'textarea', placeholder: 'Breve resumo da parte dispositiva' }
                    ]
                },
                {
                    id: 'hora_encerramento',
                    pergunta: 'Hor√°rio de Encerramento:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'hora_encerramento', label: 'Hora', tipo: 'time' }
                    ]
                }
            ],

            adiamento: [
                {
                    id: 'dados_processo',
                    pergunta: 'Dados do Processo:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'numero_processo', label: 'N√∫mero do Processo', tipo: 'text' },
                        { nome: 'data_audiencia', label: 'Data', tipo: 'date' },
                        { nome: 'hora_inicio', label: 'Hor√°rio', tipo: 'time' }
                    ]
                },
                {
                    id: 'motivo_adiamento',
                    pergunta: 'Motivo do Adiamento:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'motivo', label: 'Motivo', tipo: 'textarea', placeholder: 'Ex: Aus√™ncia de testemunha, pedido das partes, etc.' }
                    ]
                },
                {
                    id: 'nova_data',
                    pergunta: 'Nova Data da Audi√™ncia:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'nova_data', label: 'Nova Data', tipo: 'date' },
                        { nome: 'nova_hora', label: 'Novo Hor√°rio', tipo: 'time' }
                    ]
                },
                {
                    id: 'hora_encerramento',
                    pergunta: 'Hor√°rio de Encerramento:',
                    tipo: 'campos',
                    campos: [
                        { nome: 'hora_encerramento', label: 'Hora', tipo: 'time' }
                    ]
                }
            ]
        };

        function selectTipoAta(tipo) {
            state.tipoAta = tipo;
            state.totalSteps = fluxos[tipo].length + 2;
            nextStep();
        }

        function nextStep() {
            const currentStepEl = document.querySelector('.step.active');
            if (currentStepEl) currentStepEl.classList.remove('active');
            
            state.currentStep++;
            updateProgress();
            
            if (state.currentStep <= state.totalSteps) {
                renderDynamicStep();
            }
        }

        function previousStep() {
            if (state.currentStep <= 2) {
                alert('Voc√™ j√° est√° na primeira pergunta!');
                return;
            }
            
            const currentStepEl = document.querySelector('.step.active');
            if (currentStepEl) currentStepEl.classList.remove('active');
            
            state.currentStep--;
            updateProgress();
            renderDynamicStep();
        }

        function restartForm() {
            if (confirm('Tem certeza que deseja reiniciar? Todos os dados ser√£o perdidos.')) {
                resetForm();
            }
        }

        function renderDynamicStep() {
            const fluxo = fluxos[state.tipoAta];
            const stepIndex = state.currentStep - 2;
            
            if (stepIndex >= fluxo.length) {
                gerarAta();
                return;
            }
            
            const stepConfig = fluxo[stepIndex];
            
            if (stepConfig.condicao && !stepConfig.condicao(state)) {
                nextStep();
                return;
            }
            
            const container = document.getElementById('dynamicSteps');
            container.innerHTML = '';
            
            const stepDiv = document.createElement('div');
            stepDiv.className = 'step active';
            
            const question = document.createElement('div');
            question.className = 'question';
            question.textContent = stepConfig.pergunta;
            stepDiv.appendChild(question);
            
            if (stepConfig.tipo === 'opcao' || stepConfig.tipo_input === 'opcao') {
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'options';
                
                stepConfig.opcoes.forEach(opcao => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = opcao.texto;
                    btn.onclick = () => {
                        state.respostas[stepConfig.id] = opcao.valor;
                        nextStep();
                    };
                    optionsDiv.appendChild(btn);
                });
                
                stepDiv.appendChild(optionsDiv);
            } else if (stepConfig.tipo === 'campos' || stepConfig.tipo_input === 'campos') {
                stepConfig.campos.forEach(campo => {
                    const inputGroup = document.createElement('div');
                    inputGroup.className = 'input-group';
                    
                    const label = document.createElement('label');
                    label.textContent = campo.label;
                    inputGroup.appendChild(label);
                    
                    if (campo.tipo === 'select') {
                        const select = document.createElement('select');
                        select.id = campo.nome;
                        
                        campo.opcoes.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt;
                            option.textContent = opt;
                            select.appendChild(option);
                        });
                        
                        inputGroup.appendChild(select);
                    } else if (campo.tipo === 'textarea') {
                        const textarea = document.createElement('textarea');
                        textarea.id = campo.nome;
                        if (campo.placeholder) textarea.placeholder = campo.placeholder;
                        inputGroup.appendChild(textarea);
                    } else {
                        const input = document.createElement('input');
                        input.type = campo.tipo;
                        input.id = campo.nome;
                        if (campo.placeholder) input.placeholder = campo.placeholder;
                        inputGroup.appendChild(input);
                    }
                    
                    stepDiv.appendChild(inputGroup);
                });
                
                const btnNext = document.createElement('button');
                btnNext.className = 'btn-primary';
                btnNext.textContent = 'Continuar ‚û°Ô∏è';
                btnNext.onclick = () => {
                    stepConfig.campos.forEach(campo => {
                        const input = document.getElementById(campo.nome);
                        state.respostas[campo.nome] = input ? input.value : '';
                    });
                    nextStep();
                };
                stepDiv.appendChild(btnNext);
            }
            
            const navDiv = document.createElement('div');
            navDiv.className = 'navigation-buttons';
            
            const btnPrev = document.createElement('button');
            btnPrev.className = 'btn-nav';
            btnPrev.textContent = '‚¨ÖÔ∏è Voltar';
            btnPrev.onclick = previousStep;
            navDiv.appendChild(btnPrev);
            
            const btnRestart = document.createElement('button');
            btnRestart.className = 'btn-nav restart';
            btnRestart.textContent = 'üîÑ Reiniciar';
            btnRestart.onclick = restartForm;
            navDiv.appendChild(btnRestart);
            
            stepDiv.appendChild(navDiv);
            container.appendChild(stepDiv);
        }

        function updateProgress() {
            const percentage = (state.currentStep / state.totalSteps) * 100;
            document.getElementById('progressFill').style.width = percentage + '%';
        }

        function formatarData(data) {
            if (!data) return '';
            const [ano, mes, dia] = data.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function formatarHora(hora) {
            if (!hora) return '';
            return hora.replace(':', 'h');
        }

        function gerarAta() {
            let ataHTML = '';
            const r = state.respostas;
            
            if (state.tipoAta === 'instrucao_julgamento') {
                const defensor = r.tipo_defesa === 'Defensoria P√∫blica' 
                    ? `Dr. ${r.nome_defensor_publico || '[NOME DO DEFENSOR P√öBLICO]'}`
                    : `Dr. ${r.nome_defensor || '[NOME DO ADVOGADO]'} - ${r.oab_defensor || 'OAB'}`;

                ataHTML = `<strong>AUDI√äNCIA DE INSTRU√á√ÉO E JULGAMENTO</strong>

<br><br><strong>PROCESSO:</strong> ${r.numero_processo || '[N√öMERO DO PROCESSO]'}
<br><strong>JUIZ:</strong> ROG√âRIO MONTELES DA COSTA
<br><strong>PROMOTOR:</strong> ${r.promotor || '[NOME DO PROMOTOR]'}
<br><strong>DENUNCIADO:</strong> ${r.nome_reu || '[NOME DO R√âU]'}
<br><strong>DEFENSOR:</strong> ${defensor}
<br><strong>CAPITULA√á√ÉO:</strong> ${r.capitulacao || '[CAPITULA√á√ÉO]'}
<br><strong>DATA:</strong> ${formatarData(r.data_audiencia) || '[DATA]'} √†s ${formatarHora(r.hora_inicio) || '[HORA]'}
<br><strong>LINK:</strong> ${r.link_meet || '[LINK DA AUDI√äNCIA]'}

<br><br><strong>I - TERMO DE AUDI√äNCIA:</strong> Iniciada a audi√™ncia por sistema de Webconfer√™ncia realizada por meio de acesso ao link ${r.link_meet || '[LINK]'}, na presen√ßa do Excelent√≠ssimo Senhor Dr. ROG√âRIO MONTELES DA COSTA, Juiz de Direito Titular da 1¬™ Vara Criminal de Timon, foi constatada a presen√ßa do Promotor de Justi√ßa, Dr. ${r.promotor || '[PROMOTOR]'} e do ${r.tipo_defesa === 'Defensoria P√∫blica' ? 'Defensor P√∫blico, ' + defensor : 'Advogado Constitu√≠do, ' + defensor}.

${r.presenca_reu === 'presente' ? '<br><br>Presente o(s) r√©u(s) ' + (r.nome_reu || '[NOME DO R√âU]') + '.' : '<br><br>Ausente o(s) r√©u(s) ' + (r.nome_reu || '[NOME DO R√âU]') + ', apesar de devidamente intimado(s).'}

${r.estudantes === 'sim' && r.estudantes_lista ? '<br><br>Presentes os estudantes de Direito: ' + r.estudantes_lista.replace(/\n/g, '; ') + '.' : ''}

${r.testemunhas_acusacao ? '<br><br><strong>Participaram da audi√™ncia por Webconfer√™ncia as testemunhas de acusa√ß√£o:</strong> ' + r.testemunhas_acusacao : ''}

${r.testemunhas_ausentes_acusacao ? '<br><br><strong>Ausentes as testemunhas de acusa√ß√£o:</strong> ' + r.testemunhas_ausentes_acusacao : ''}

${r.testemunhas_defesa ? '<br><br><strong>Testemunhas de defesa presentes:</strong> ' + r.testemunhas_defesa : ''}

${r.desistencia_testemunhas ? '<br><br>A Defesa requereu desist√™ncia das seguintes testemunhas: ' + r.desistencia_testemunhas + '. O Minist√©rio P√∫blico e o MM. Juiz HOMOLOGARAM a desist√™ncia.' : ''}

${r.presenca_reu === 'presente' ? '<br><br>Nesse momento, ao(s) r√©u(s) foi assegurado o direito de manter uma conversa reservada com a Defesa.' : ''}

<br><br>Em seguida o MM. Juiz passou a inquirir as testemunhas. 

<br><br><strong>INQUIRI√á√ÉO DAS TESTEMUNHAS:</strong> As testemunhas prestaram o compromisso legal de falar a verdade, previsto no art. 203 do CPP. Inquiridas sobre os fatos constantes na den√∫ncia, prestaram depoimentos que ficaram registrados em √°udio e v√≠deo, dispon√≠veis no <strong>PJe M√≠dias</strong> atrav√©s do link (chave de acesso) constante no final desta ata.

${r.presenca_reu === 'presente' ? '<br><br>Nesse momento, foi assegurado ao(s) r√©u(s) o direito de manter conversa reservada com a Defesa.' : ''}

${r.presenca_reu === 'presente' ? '<br><br><strong>INTERROGAT√ìRIO DO R√âU:</strong> O r√©u foi informado do seu direito ao sil√™ncio, previsto no art. 186 do C√≥digo de Processo Penal. Interrogado sobre os fatos constantes na den√∫ncia, prestou depoimento que ficou registrado em √°udio e v√≠deo, dispon√≠vel no <strong>PJe M√≠dias</strong> atrav√©s do link (chave de acesso) constante no final desta ata.' : ''}

${r.instrucao === 'encerrada' ? '<br><br><strong>Declaro encerrada a instru√ß√£o processual.</strong>' : '<br><br><strong>Audi√™ncia adiada para nova data.</strong>'}

${r.alegacoes === 'orais' ? `<br><br><strong>ALEGA√á√ïES FINAIS ORAIS:</strong>

<br><br>O Minist√©rio P√∫blico, em alega√ß√µes finais orais, ${r.alegacoes_mp || 'apresentou suas raz√µes registradas em √°udio e v√≠deo'}.

<br><br>A Defesa, em alega√ß√µes finais orais, ${r.alegacoes_defesa || 'apresentou suas raz√µes registradas em √°udio e v√≠deo'}.

<br><br><strong>ALEGA√á√ïES FINAIS REGISTRADAS EM √ÅUDIO E V√çDEO DISPON√çVEL NO PJe M√≠dias</strong> atrav√©s do link (chave de acesso) constante no final desta ata.` : ''}

${r.alegacoes === 'memoriais' ? `<br><br><strong>II - DESPACHO:</strong> Declaro encerrada a instru√ß√£o processual. DEFIRO o pedido e converto as alega√ß√µes finais orais em memoriais. Determino que a secretaria intime o Minist√©rio P√∫blico para que no prazo de <strong>${r.prazo_mp || '05'} (cinco) dias</strong> apresente as alega√ß√µes finais em forma de memoriais. Transcorrido o prazo, a secretaria promova a intima√ß√£o da Defesa para que no prazo de <strong>${r.prazo_defesa || '05'} (cinco) dias</strong> tamb√©m apresente as alega√ß√µes finais em forma de memoriais. Transcorridos os prazos, devem os autos serem conclusos para a senten√ßa.` : ''}

${r.despacho_final === 'sim' && r.despacho_texto ? '<br><br><strong>DESPACHO/DECIS√ÉO:</strong> ' + r.despacho_texto : ''}

<br><br>Nada mais foi dito, tendo o MM Juiz encerrado o presente termo que foi devidamente assinado.

<br><br><strong>√Åudio e v√≠deo de audi√™ncia dispon√≠vel no PJe M√≠dias atrav√©s do link (chave de acesso):</strong>
<br>[INSERIR LINK DO PJE M√çDIAS]

<br><br>Eu, [NOME DO SERVIDOR], matr√≠cula [MATR√çCULA], digitei e subscrevi.

<br><br><strong>Audi√™ncia encerrada √†s ${formatarHora(r.hora_encerramento) || '[HORA]'}.</strong>
<br>Nada mais.

<br><br><br><strong>ROG√âRIO MONTELES DA COSTA</strong>
<br><em>Juiz de Direito</em>`;

            } else if (state.tipoAta === 'anpp') {
                const defensor = r.tipo_defesa === 'Defensoria P√∫blica' 
                    ? `Dr. ${r.nome_defensor_publico || '[NOME DO DEFENSOR P√öBLICO]'}`
                    : `Dr. ${r.nome_advogado || '[NOME DO ADVOGADO]'} - ${r.oab_advogado || 'OAB'}`;

                // Calcular data limite se n√£o fornecida
                let dataLimite = r.data_limite_cumprimento;
                if (!dataLimite && r.data_audiencia && r.prazo_dias) {
                    const dataAud = new Date(r.data_audiencia);
                    dataAud.setDate(dataAud.getDate() + parseInt(r.prazo_dias));
                    dataLimite = dataAud.toISOString().split('T')[0];
                }

                ataHTML = `<strong>AUDI√äNCIA DE HOMOLOGA√á√ÉO DE ACORDO DE N√ÉO PERSECU√á√ÉO PENAL</strong>

<br><br><strong>PROCESSO:</strong> ${r.numero_processo || '[N√öMERO DO PROCESSO]'}
<br><strong>JUIZ:</strong> ROG√âRIO MONTELES DA COSTA
<br><strong>DENUNCIADO:</strong> ${r.nome_investigado || '[NOME DO INVESTIGADO]'}
<br><strong>ADVOGADO:</strong> ${defensor}
<br><strong>CAPITULA√á√ÉO:</strong> ${r.capitulacao || '[CAPITULA√á√ÉO]'}
<br><strong>DATA:</strong> ${formatarData(r.data_audiencia) || '[DATA]'} - ${formatarHora(r.hora_inicio) || '[HORA]'}
<br><strong>LINK:</strong> ${r.link_meet || '[LINK]'}

<br><br><strong>I - TERMO DE AUDI√äNCIA:</strong> Iniciada a audi√™ncia por sistema de Webconfer√™ncia realizada por meio de acesso ao link ${r.link_meet || '[LINK]'}, na presen√ßa da MM¬™. Juiz de Direito respondendo pela 1¬™ Vara Criminal da Comarca de Timon/MA, Dr. ROG√âRIO MONTELES DA COSTA, foi constatada a participa√ß√£o do ${r.tipo_defesa === 'Defensoria P√∫blica' ? 'Defensor P√∫blico' : 'Advogado Constitu√≠do'}, ${defensor}, e do investigado ${r.nome_investigado || '[NOME]'}. 

<br><br>Iniciada a audi√™ncia, o MM Juiz analisou os autos e verificou que o Minist√©rio P√∫blico realizou Acordo de N√£o Persecu√ß√£o Penal (ANPP) com o acusado e seu defensor. O MM Juiz passou √† an√°lise para fins de homologa√ß√£o. 

<br><br>Observou nas cl√°usulas do Termo de ANPP que o acusado confessou a pr√°tica do crime, lhe foi proposta a obriga√ß√£o de fazer de:

${r.clausula_1 ? '<br><br><strong>I</strong> - ' + r.clausula_1 : ''}

${r.clausula_2 ? '<br><br><strong>II</strong> - ' + r.clausula_2 : ''}

${r.clausula_3 ? '<br><br><strong>III</strong> - ' + r.clausula_3 : ''}

<br><br>O MM Juiz, ent√£o, questionou ${r.nome_investigado || '[NOME]'} se ele est√° de acordo com as cl√°usulas propostas pelo Minist√©rio P√∫blico, se ele confessou a pr√°tica do crime e se est√° ciente de que n√£o poder√° firmar novo acordo com a Justi√ßa nos pr√≥ximos 5 (cinco) anos. 

<br><br>O investigado ${r.acordo_clausulas === 'Sim' ? 'confirmou que est√° de acordo com as cl√°usulas impostas' : 'n√£o concordou com as cl√°usulas'}, ${r.ciente_restricao === 'Sim' ? 'que est√° ciente de que n√£o poder√° firmar novo acordo com a Justi√ßa nos pr√≥ximos 5 (cinco) anos' : 'manifestou d√∫vidas sobre as consequ√™ncias'} e ${r.confessou_crime === 'Sim' ? 'que confessou ao Promotor de Justi√ßa a pr√°tica do crime' : 'n√£o confessou a pr√°tica do crime'}.

<br><br>Com a palavra, a defesa requereu a homologa√ß√£o do Acordo de N√£o Persecu√ß√£o firmado e a intima√ß√£o do Minist√©rio P√∫blico para as provid√™ncias legais. 

<br><br>Em seguida o MM Juiz prolatou a seguinte DECIS√ÉO:

<br><br><strong>II - DECIS√ÉO:</strong> "Analisando as cl√°usulas do Acordo de N√£o Persecu√ß√£o Penal firmado entre o acusado, seu defensor e o Minist√©rio P√∫blico, entendo pela legalidade do ato ante a observ√¢ncia dos requisitos impostos pelo art. 28-A do CPP. O denunciado concordou com as cl√°usulas impostas, est√° ciente das consequ√™ncias de firmar o acordo e confessou formalmente a pr√°tica do crime. O r√©u, em ju√≠zo, se comprometeu a cumprir a obriga√ß√£o de fazer imposta, raz√£o pela qual <strong>HOMOLOGO O ACORDO DE N√ÉO PERSECU√á√ÉO PENAL</strong> constante nos autos e <strong>DETERMINO A SUSPENS√ÉO DO PROCESSO</strong> pelo prazo de cumprimento da obriga√ß√£o de fazer, a saber, <strong>${r.prazo_dias || '30'} (trinta) dias</strong>, qual seja, at√© <strong>${formatarData(dataLimite) || '[DATA LIMITE]'}</strong>, devendo o Minist√©rio P√∫blico promover a instaura√ß√£o do procedimento de execu√ß√£o junto √† Vara de Execu√ß√£o pelo sistema SEEU nos termos do artigo do art. 28-A, par√°grafo 6¬∫, do CPP. 

<br><br>DETERMINO que o nome de ${r.nome_investigado || '[NOME]'} fique registrado nos nossos registros criminais deste ju√≠zo para fins de impedir que ele tenha direito a um novo acordo criminal no prazo de 05 (cinco) anos a contar da presente data. 

<br><br>Por fim, havendo cumprimento integral o Ju√≠zo da Vara de Execu√ß√£o Penal determinar√° a extin√ß√£o do processo. Caso contr√°rio, haver√° prosseguimento do feito. 

<br><br>Intime-se o Minist√©rio P√∫blico. Partes intimadas em audi√™ncia."

<br><br>Nada mais foi dito, tendo o MM Juiz encerrado o presente termo que foi devidamente assinado. 

<br><br><strong>√Åudio e v√≠deo de audi√™ncia dispon√≠vel no PJe M√≠dias atrav√©s do link (chave de acesso):</strong>
<br>[INSERIR LINK DO PJE M√çDIAS]

<br><br>Eu, ${r.nome_servidor || '[NOME DO SERVIDOR]'}, matr√≠cula ${r.matricula_servidor || '[MATR√çCULA]'}, digitei e subscrevi.

<br><br><strong>Audi√™ncia encerrada √†s ${formatarHora(r.hora_encerramento) || '[HORA]'}.</strong>

<br><br><br><strong>ROG√âRIO MONTELES DA COSTA</strong>
<br><em>Juiz de Direito</em>`;

            } else if (state.tipoAta === 'interrogatorio') {
                ataHTML = `<strong>AUDI√äNCIA DE INTERROGAT√ìRIO</strong>

<br><br><strong>PROCESSO:</strong> ${r.numero_processo || '[N√öMERO DO PROCESSO]'}
<br><strong>JUIZ:</strong> ROG√âRIO MONTELES DA COSTA
<br><strong>PROMOTOR:</strong> ${r.promotor || '[PROMOTOR]'}
<br><strong>DENUNCIADO:</strong> ${r.nome_reu || '[NOME DO R√âU]'}
<br><strong>CAPITULA√á√ÉO:</strong> ${r.capitulacao || '[CAPITULA√á√ÉO]'}
<br><strong>DATA:</strong> ${formatarData(r.data_audiencia)} √†s ${formatarHora(r.hora_inicio)}

<br><br><strong>I - TERMO DE AUDI√äNCIA:</strong> Iniciada a audi√™ncia de interrogat√≥rio do r√©u ${r.nome_reu || '[NOME]'}.

<br><br><strong>INTERROGAT√ìRIO:</strong> O r√©u foi informado do seu direito ao sil√™ncio, previsto no art. 186 do CPP. 

${r.interrogatorio_tipo === 'confessou' ? '<br><br>O r√©u CONFESSOU a pr√°tica dos fatos descritos na den√∫ncia.' : ''}
${r.interrogatorio_tipo === 'negou' ? '<br><br>O r√©u NEGOU a autoria delitiva, afirmando ser inocente dos fatos que lhe s√£o imputados.' : ''}
${r.interrogatorio_tipo === 'silencio' ? '<br><br>O r√©u exerceu seu DIREITO AO SIL√äNCIO, nos termos do art. 186 do CPP.' : ''}

<br><br><strong>Interrogat√≥rio registrado em √°udio e v√≠deo, dispon√≠vel no PJe M√≠dias.</strong>

<br><br><strong>PR√ìXIMOS ATOS:</strong> ${r.proximos_atos || '[DETERMINAR PR√ìXIMOS ATOS]'}

<br><br>Audi√™ncia encerrada √†s <strong>${formatarHora(r.hora_encerramento)}</strong>.

<br><br><strong>ROG√âRIO MONTELES DA COSTA</strong>
<br><em>Juiz de Direito</em>`;

            } else if (state.tipoAta === 'sentenca') {
                ataHTML = `<strong>AUDI√äNCIA COM SENTEN√áA</strong>

<br><br><strong>PROCESSO:</strong> ${r.numero_processo || '[N√öMERO]'}
<br><strong>DATA:</strong> ${formatarData(r.data_audiencia)} √†s ${formatarHora(r.hora_inicio)}

<br><br><strong>SENTEN√áA PROFERIDA EM AUDI√äNCIA</strong>

${r.tipo_sentenca === 'absolutoria' ? '<br><br>O MM. Juiz ABSOLVEU o r√©u, com fundamento no <strong>' + (r.fundamento_legal || 'Art. 386 do CPP') + '</strong>.' : ''}

${r.tipo_sentenca === 'condenatoria' ? '<br><br>O MM. Juiz CONDENOU o r√©u, nos termos da fundamenta√ß√£o constante dos autos.' : ''}

${r.tipo_sentenca === 'improcedencia' ? '<br><br>O MM. Juiz julgou IMPROCEDENTE a pretens√£o punitiva veiculada na den√∫ncia, com fundamento no <strong>' + (r.fundamento_legal || 'Art. 386, VII do CPP') + '</strong>.' : ''}

<br><br><strong>DISPOSITIVO:</strong> ${r.dispositivo || '[RESUMO DO DISPOSITIVO]'}

<br><br>Senten√ßa publicada em audi√™ncia, saem os presentes intimados.

<br><br><strong>SENTEN√áA REGISTRADA EM √ÅUDIO E V√çDEO DISPON√çVEL NO PJe M√≠dias.</strong>

<br><br>Audi√™ncia encerrada √†s <strong>${formatarHora(r.hora_encerramento)}</strong>.

<br><br><strong>ROG√âRIO MONTELES DA COSTA</strong>
<br><em>Juiz de Direito</em>`;

            } else if (state.tipoAta === 'adiamento') {
                ataHTML = `<strong>TERMO DE ADIAMENTO DE AUDI√äNCIA</strong>

<br><br><strong>PROCESSO:</strong> ${r.numero_processo || '[N√öMERO]'}
<br><strong>DATA:</strong> ${formatarData(r.data_audiencia)} √†s ${formatarHora(r.hora_inicio)}

<br><br><strong>MOTIVO DO ADIAMENTO:</strong> ${r.motivo || '[MOTIVO]'}

<br><br><strong>NOVA DATA DESIGNADA:</strong> ${formatarData(r.nova_data) || '[DATA]'} √†s ${formatarHora(r.nova_hora) || '[HORA]'}

<br><br>Partes presentes intimadas. As demais ser√£o intimadas por secretaria.

<br><br>Audi√™ncia encerrada √†s <strong>${formatarHora(r.hora_encerramento)}</strong>.

<br><br><strong>ROG√âRIO MONTELES DA COSTA</strong>
<br><em>Juiz de Direito</em>`;
            }

            document.getElementById('outputText').innerHTML = ataHTML;
            document.getElementById('stepOutput').classList.add('active');
        }

        function copyToClipboard() {
            const outputText = document.getElementById('outputText');
            
            const listener = function(e) {
                const htmlContent = outputText.innerHTML;
                const textContent = outputText.innerText;
                
                e.clipboardData.setData('text/html', htmlContent);
                e.clipboardData.setData('text/plain', textContent);
                e.preventDefault();
            };
            
            document.addEventListener('copy', listener);
            
            const range = document.createRange();
            range.selectNodeContents(outputText);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            try {
                document.execCommand('copy');
                
                const btn = event.target;
                btn.textContent = '‚úÖ Copiado com formata√ß√£o!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.textContent = 'üìã Copiar para √Årea de Transfer√™ncia';
                    btn.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Erro ao copiar:', err);
                alert('Erro ao copiar. Por favor, selecione manualmente o texto e use Ctrl+C (ou Cmd+C no Mac).');
            }
            
            selection.removeAllRanges();
            document.removeEventListener('copy', listener);
        }

        function resetForm() {
            state.tipoAta = null;
            state.currentStep = 1;
            state.totalSteps = 0;
            state.respostas = {};
            
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
            document.getElementById('dynamicSteps').innerHTML = '';
            document.getElementById('progressFill').style.width = '0%';
        }
    </script>
</body>
</html>
